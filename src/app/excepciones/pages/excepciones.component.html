<div class="excepciones-fullpage">
  <div class="card shadow-sm border-0 excepciones-card-full">
    <div class="card-header bg-transparent border-0 text-center">
      <span class="modal-title d-inline-block px-4 py-2 rounded-pill text-white" style="background-color:#AD0000;">
        <strong class="text-uppercase fs-5">Excepciones</strong>
      </span>
    </div>
    <div class="card-body">
      <div style="overflow-x: auto;">
        <table class="table table-bordered align-middle mb-0" style="min-width: 600px;">
          <thead class="table-light">
            <tr>
              <th class="sticky-col bg-white" style="left:0; z-index:2;">Acciones</th>
              <th>Error</th>
              <th>Mensaje</th>
            </tr>
          </thead>
          <tbody>
            <!-- Fila de formulario para agregar excepciÃ³n -->
            <tr>
              <td class="sticky-col bg-white text-center" style="left:0; z-index:2;">
                <button class="btn btn-outline-success" type="button" (click)="agregarExcepcion()" [disabled]="editandoId !== null">Agregar</button>
              </td>
              <td>
                <input class="form-control" [(ngModel)]="errorInput" placeholder="Escribe el error..." [disabled]="editandoId !== null"/>
              </td>
              <td>
                <input class="form-control" [(ngModel)]="mensajeInput" placeholder="Escribe el mensaje..." [disabled]="editandoId !== null"/>
              </td>
            </tr>
            <!-- Grid de excepciones agregadas -->
            @for (excepcion of excepciones; track excepcion.id) {
              <tr>
                <td class="sticky-col bg-white text-center" style="left:0; z-index:2;">
                  @if (editandoId === excepcion.id) {
                    <button class="btn btn-outline-success btn-sm me-1" type="button" (click)="guardarEdicionExcepcion()" [disabled]="!puedeActualizar()">Actualizar</button>
                    <button class="btn btn-outline-secondary btn-sm" type="button" (click)="cancelarEdicion()">Cancelar</button>
                  } @else {
                    <button class="btn btn-outline-primary btn-sm me-1" type="button" (click)="editarExcepcion(excepcion)">Modificar</button>
                    <button class="btn btn-outline-danger btn-sm" type="button" (click)="eliminarExcepcion(excepcion.id)">Eliminar</button>
                  }
                </td>
                <td>
                  @if (editandoId === excepcion.id) {
                    <input class="form-control" [(ngModel)]="errorInput" />
                  } @else {
                    {{ excepcion.error }}
                  }
                </td>
                <td>
                  @if (editandoId === excepcion.id) {
                    <input class="form-control" [(ngModel)]="mensajeInput" />
                  } @else {
                    {{ excepcion.mensaje }}
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
        <div class="mt-3 text-end">
          <button class="btn btn-success" type="button" (click)="guardarExcepciones()" [disabled]="excepciones.length === 0">Guardar</button>
        </div>
      </div>
    </div>
  </div>
</div>
<style>
.sticky-col {
  position: sticky;
  left: 0;
  z-index: 2;
  background: #fff;
}
</style>
